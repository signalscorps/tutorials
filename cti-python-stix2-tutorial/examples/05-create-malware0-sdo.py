from stix2 import Malware
from stix2 import TLP_AMBER
from stix2 import FileSystemStore

## Get required Objects previously saved to filesystem source
### https://stix2.readthedocs.io/en/latest/guide/filesystem.html#FileSystemSource

fs = FileSystemStore("tmp/stix2_store")
SCIdentitySDO = fs.get("identity--c73bd6f8-6cd0-4b39-a5ec-81c4461f97fb")

## Create Malware SDO with custom Properties
### https://stix2.readthedocs.io/en/latest/api/stix2.v21.html#stix2.v21.Malware
### https://stix2.readthedocs.io/en/latest/guide/custom.html#Custom-Properties
### https://stix2.readthedocs.io/en/latest/api/stix2.v21.html#stix2.v21.GranularMarking

Malware0SDOWithGranularMarkings = Malware(
                                    name="My second SDO",
                                    description="It is a Malware SDO this time",
                                    is_family=False,
                                    custom_properties={
                                        "x_foo": "bar"
                                    },
                                    created_by_ref=SCIdentitySDO,
                                    granular_markings=[
                                    {
                                        "selectors": ["name"],
                                        "marking_ref": TLP_AMBER
                                    }
                                    ]
                                )

## Write the to filesystem

fs.add([Malware0SDOWithGranularMarkings])

## malware--31d2559c-149d-44c1-9fe9-dd8c147031c3 created in FS

## Print the object

print(Malware0SDOWithGranularMarkings.serialize(pretty=True))